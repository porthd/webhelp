"use strict";(function(){class EasyVCard extends HTMLAnchorElement{constructor(){console.log("easy-vcard");super();this.addEventListener("click",this.createFile)}validateData(jsonObj){let flag=true;return flag}createFile(event){let node=this;let jsonData=node.getAttribute("eventjson"),jsonObj;try{jsonObj=JSON.parse(jsonData);let flag=(!jsonObj["dateEnd"]&&jsonObj["dateEnd"]!==""?1:0)+(!jsonObj["duration"]&&jsonObj["duration"]!==""?2:0);switch(flag){case 3:delete jsonObj["duration"];break;case 0:jsonObj["dateEnd"]=jsonObj["dateStart"];break;default:break}if(this.validateData(jsonObj)){let fileName=jsonObj["fileName"]??"invitation.ics";this.makeIcsFile(jsonObj,fileName)}else{let errorMessage="The values of the data are not valid or some data are missing. Check the JSON-String: "+jsonData;this.makeErrorFile(errorMessage);console.log(errorMessage)}}catch(e){let errorMessage="Error in JSON?"+jsonData+"\n"+e.message;this.makeErrorFile(errorMessage);console.log(errorMessage);console.log(e)}}padDouble(number){if(number<10){return"0"+number}return number}currentDateToPseudoIsoString(){let date=new Date;return date.getUTCFullYear()+ +this.padDouble(date.getUTCMonth()+1)+ +this.padDouble(date.getUTCDate())+"T"+ +this.padDouble(date.getUTCHours())+ +this.padDouble(date.getUTCMinutes())+ +this.padDouble(date.getUTCSeconds())+"Z"}folding(text){let split=[...text],result="",count="",len=split.length;for(let i=0;i<len;i++){count=count+split[i].length;if(count>=75){result+="\r\n"+split[i];count=split[i].length}else{result+="\r\n"+split[i]}}return result}makeErrorFile(message){let fileName="error.txt";this.save(fileName,message,"text/plain;charset=utf-8")}makeIcsFile(jsonObj,fileName){console.log("start");let name="N:"+jsonObj["n"]+"\r\n",revDate="REV:"+this.currentDateToPseudoIsoString()+"\r\n",fullname=jsonObj["fn"]!==""?this.folding("FN:"+jsonObj["FN"]):"",email=jsonObj["email"]!==""?this.folding("EMAIL:"+jsonObj["email"]):"",geo=jsonObj["geo"]!==""?this.folding("GEO:"+jsonObj["geo"]):"",key=jsonObj["key"].length>0?"KEY"+jsonObj["key"].join("\r\nKEY")+"\r\n":"",adr=jsonObj["adr"].length>0?"ADR"+jsonObj["adr"].join("\r\nADR")+"\r\n":"",logo=jsonObj["logo"]!==""?this.folding("LOGO:"+jsonObj["logo"]):"",n=jsonObj["n"]!==""?this.folding("N:"+jsonObj["n"]):"",note=jsonObj["note"]!==""?this.folding("NOTE:"+jsonObj["note"]):"",org=jsonObj["org"]!==""?this.folding("ORG:"+jsonObj["org"]):"",photo=jsonObj["photo"]!==""?this.folding("PHOTO:"+jsonObj["photo"]):"",role=jsonObj["role"]!==""?this.folding("ROLE:"+jsonObj["role"]):"",tel=jsonObj["tel"].length>0?"TEL"+jsonObj["tel"].join("\r\nTEL")+"\r\n":"",title=jsonObj["title"]!==""?this.folding("TITLE:"+jsonObj["title"]):"",tz=jsonObj["tz"]!==""?this.folding("TZ:"+jsonObj["tz"]):"",uid=jsonObj["uid"]!==""?this.folding("UID:"+jsonObj["uid"]):"",url=jsonObj["url"]!==""?this.folding("URL:"+jsonObj["url"]):"",version="VERSION:4.0"+"\r\n";let vcardText="BEGIN:VCARD"+"\r\n"+version+name+fullname+email+geo+key+adr+logo+n+note+org+photo+role+tel+title+tz+uid+url+revDate+"END:VCARD";console.log("start save");this.save(fileName,vcardText,"text/vcard;charset=utf-8");console.log("save done")}save(filename,data,type){let blob=new Blob([data],{type:type});if(window.navigator.msSaveOrOpenBlob){window.navigator.msSaveBlob(blob,filename)}else{var elem=window.document.createElement("a");elem.href=window.URL.createObjectURL(blob);elem.download=filename;document.body.appendChild(elem);elem.click();document.body.removeChild(elem)}}}customElements.define("easy-vcard",EasyVCard,{extends:"a"})})();