"use strict";(function(){class EasyICalendar extends HTMLAnchorElement{constructor(){super();this.addEventListener("click",this.createFile)}validateValue(testString){return true}validateDateTime(testString){let flag=true,withTimezone=testString.split(":"),check=withTimezone.length===1?withTimezone[0]:withTimezone[1],parts=check.split("T");if(withTimezone.length>1){flag=flag&&(withTimezone[0].substr(0,5)==="TZID="||withTimezone[0]==="VALUE=DATE"||withTimezone[0]==="VALUE=DATE-TIME")}flag=flag&&parts.length<=2;flag=flag&&/[^0-9]/.test(parts[0]);flag=flag&&parts.length===8;if(parts.length===2){if(parts[1].length===6){flag=flag&&/[^0-9]/.test(parts[1])}else if(parts[1].length===7){flag=flag&&/[^0-9]/.test(parts[1].substr(0,6));flag=flag&&parts[1].substr(6)==="Z"}else{flag=flag&&false}}return flag}validateDuration(testString){let flag=/[^\-+PTWHMSD0-9]/.test(testString),split=[...testString];flag=flag&&split.length>2;flag=flag&&(split[0]==="P"||(split[0]==="-"||split[0]==="+")&&split[1]==="P");flag=flag&&/[HMSD]/.test(split[split.length-1]);return flag}validateData(jsonObj){let flag=true;flag=flag&&(!jsonObj["uid"]?false:this.validateValue(jsonObj["uid"]));flag=flag&&(!jsonObj["organizer"]?false:this.validateValue(jsonObj["organizer"]));flag=flag&&(!jsonObj["summary"]?false:this.validateValue(jsonObj["summary"]));flag=flag&&(!jsonObj["dateStart"]?false:this.validateDateTime(jsonObj["dateStart"]));flag=flag&&((!jsonObj["duration"]?false:this.validateDuration(jsonObj["duration"]))||(!jsonObj["dateEnd"]?false:this.validateDateTime(jsonObj["dateEnd"])));flag=flag&&(!jsonObj["location"]?true:this.validateValue(jsonObj["location"]));flag=flag&&(!jsonObj["contact"]?true:this.validateValue(jsonObj["contact"]));flag=flag&&(!jsonObj["url"]?true:this.validateValue(jsonObj["url"]));flag=flag&&!jsonObj["description"]?true:this.validateValue(jsonObj["description"]);return flag}createFile(event){let node=this;let jsonData=node.getAttribute("eventjson"),jsonObj;try{jsonObj=JSON.parse(jsonData);let flag=(!jsonObj["dateEnd"]&&jsonObj["dateEnd"]!==""?1:0)+(!jsonObj["duration"]&&jsonObj["duration"]!==""?2:0);switch(flag){case 3:delete jsonObj["duration"];break;case 0:jsonObj["dateEnd"]=jsonObj["dateStart"];break;default:break}if(this.validateData(jsonObj)){let fileName=jsonObj["fileName"]??"invitation.ics";this.makeIcsFile(jsonObj,fileName)}else{let errorMessage="The values of the data are not valid or some data are missing. Check the JSON-String: "+jsonData;this.makeErrorFile(errorMessage);console.log(errorMessage)}}catch(e){let errorMessage="Error in JSON?"+jsonData+"\n"+e.message;this.makeErrorFile(errorMessage);console.log(errorMessage);console.log(e)}}folding(text){let split=[...text],result="",count="",len=split.length;for(let i=0;i<len;i++){count=count+split[i].length;if(count>=75){result+="\r\n"+split[i];count=split[i].length}else{result+="\r\n"+split[i]}}return result}makeErrorFile(message){let fileName="error.txt";this.save(fileName,message,"text/plain;charset=utf-8")}makeIcsFile(jsonObj,fileName){let organizer=this.folding("ORGANIZER:"+jsonObj["organizer"]),uid=this.folding("UID:"+jsonObj["uid"]),url=this.folding("URL:"+jsonObj["url"]),location=jsonObj["location"]!==""?this.folding("LOCATION:"+jsonObj["location"]):"",description=jsonObj["description"]!==""?this.folding("LOCATION:"+jsonObj["description"]):"",contact=jsonObj["contact"]!==""?this.folding("LOCATION:"+jsonObj["contact"]):"",summary=jsonObj["summary"]!==""?this.folding("LOCATION:"+jsonObj["summary"]):"",nowStamp="DTSTAMP:"+Math.round((new Date).getUTCMilliseconds()/1e3),addStartTime=/[:]/.test(jsonObj["dateStart"])?"":":",startTime="DTSTART"+addStartTime+jsonObj["dateStart"],addEndTime=/[:]/.test(jsonObj["dateEnd"])?"":":",endTime=!jsonObj["duration"]?"DTEND"+addEndTime+jsonObj["dateEnd"]:"DURATION:"+jsonObj["duration"],calendarText="BEGIN:VCALENDAR\r\n"+"CALSCALE:GREGORIAN\r\n"+"METHOD:PUBLISH\r\n"+"PRODID:-//porthd/webhelp//EN\r\n"+"VERSION:2.0\r\n"+"BEGIN:VEVENT\r\n"+uid+"\r\n"+url+"\r\n"+organizer+"\r\n"+nowStamp+"\r\n"+startTime+"\r\n"+endTime+"\r\n"+location+"\r\n"+contact+"\r\n"+description+"\r\n"+summary+"\r\n"+"END:VEVENT\r\n"+"END:VCALENDAR";this.save(fileName,calendarText,"text/calendar;charset=utf-8")}save(filename,data,type){let blob=new Blob([data],{type:type});if(window.navigator.msSaveOrOpenBlob){window.navigator.msSaveBlob(blob,filename)}else{var elem=window.document.createElement("a");elem.href=window.URL.createObjectURL(blob);elem.download=filename;document.body.appendChild(elem);elem.click();document.body.removeChild(elem)}}}customElements.define("easy-icalendar",EasyICalendar,{extends:"a"})})();